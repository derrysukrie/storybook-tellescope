import { Meta, Canvas, ArgTypes, Story } from "@storybook/addon-docs/blocks"
import { SentForm } from './SentForm';
import * as SentFormStories from './SentForm.stories.tsx';

<Meta of={SentFormStories} />

# SentForm

A powerful, configuration-driven multi-step form organism that provides excellent developer experience and user experience.

## Overview

The `SentForm` component is a true **Organism** that encapsulates complete form functionality. It accepts configuration instead of requiring manual component composition, making it easy to create complex multi-step forms.

## Key Features

- ✅ **Configuration-driven** - No manual component imports needed
- ✅ **Type-safe** - Full TypeScript support
- ✅ **Performance optimized** - Debounced updates, memoized components
- ✅ **Proper UX flow** - Intro → Description → Form fields
- ✅ **Label display** - Shows user-friendly labels while storing API-ready values
- ✅ **Self-contained** - All step components imported internally

## Basic Usage

```tsx
import { SentForm } from './Organism/SentForm';

// Common options for reusability
const commonOptions = {
  countries: [
    { value: "us", label: "United States" },
    { value: "ca", label: "Canada" },
    { value: "uk", label: "United Kingdom" },
  ],
  contactMethods: [
    { id: "email", label: "Email", value: "email" },
    { id: "phone", label: "Phone call", value: "phone" },
  ],
};

function MyForm() {
  return (
    <SentForm
      steps={[
        // Always start with intro
        {
          type: "intro",
          id: "welcome",
        },
        // Add context
        {
          type: "description",
          id: "description",
          description: "Let's get to know you better to find the perfect plan.",
        },
        // Form fields
        {
          type: "select",
          id: "location",
          title: "Where are you located?",
          options: commonOptions.countries,
          placeholder: "Choose your country",
          helperText: "This helps us provide location-specific services",
        },
        {
          type: "choice",
          id: "contact_preference",
          label: "How would you prefer to be contacted?",
          options: commonOptions.contactMethods,
          helperText: "We'll use this as your primary contact method",
        },
      ]}
      onFormDataChange={(formData) => {
        console.log("Form data updated:", formData);
        // formData = { location: "us", contact_preference: "email" }
      }}
      onComplete={(formData) => {
        console.log("Form completed:", formData);
        // Send to API with values, not labels
      }}
    />
  );
}
```

## Step Types

### Intro Step
Welcome screen that appears first.

```tsx
{
  type: "intro",
  id: "welcome",
}
```

### Description Step
Provides context and explanation to users.

```tsx
{
  type: "description",
  id: "description",
  description: "Great, we have a variety of plans to fit your needs...",
}
```

### Select Step
Single choice dropdown with labels displayed to users.

```tsx
{
  type: "select",
  id: "location",
  title: "Where are you located?",
  options: [
    { value: "us", label: "United States" },
    { value: "ca", label: "Canada" },
  ],
  placeholder: "Choose your country",
  helperText: "This helps us provide location-specific services",
}
```

### Multi-Select Step
Multiple choice dropdown with chips display.

```tsx
{
  type: "multiSelect",
  id: "interests",
  title: "What are your interests?",
  options: [
    { value: "tech", label: "Technology" },
    { value: "health", label: "Healthcare" },
  ],
  placeholder: "Select multiple interests",
  helperText: "Choose all that apply",
}
```

### Choice Step
Radio button group for single selection.

```tsx
{
  type: "choice",
  id: "contact_preference",
  label: "How would you prefer to be contacted?",
  options: [
    { id: "email", label: "Email", value: "email" },
    { id: "phone", label: "Phone call", value: "phone" },
  ],
  helperText: "We'll use this as your primary contact method",
}
```

### Text Input Steps
Various text input types.

```tsx
// Basic text input
{
  type: "text",
  id: "name",
}

// Email input
{
  type: "email",
  id: "email",
}

// Phone input
{
  type: "phone",
  id: "phone",
}

// Number input
{
  type: "number",
  id: "age",
}

// Long text input
{
  type: "longText",
  id: "description",
}
```

### Checkbox Step
Multiple checkbox selection.

```tsx
{
  type: "checkbox",
  id: "preferences",
  title: "What are your preferences?",
  options: [
    { value: "newsletter", label: "Receive newsletter" },
    { value: "updates", label: "Product updates" },
    { value: "marketing", label: "Marketing emails" },
  ],
  helperText: "Select all that apply",
}
```

## Props

The `SentForm` component accepts the following props:

| Prop | Type | Required | Default | Description |
|------|------|----------|---------|-------------|
| `steps` | `StepConfig[]` | ✅ | - | Array of step configurations |
| `onComplete` | `(data: FormData) => void` | ❌ | - | Callback when form is completed |
| `onFormDataChange` | `(formData: FormData) => void` | ❌ | - | Callback when form data changes (debounced) |
| `debounceDelay` | `number` | ❌ | `300` | Debounce delay in milliseconds |

## Data Flow

### Form Data Structure
The form data is collected as key-value pairs where:
- **Keys** are the step IDs
- **Values** are the selected values (not labels)

```tsx
// Example form data
{
  location: "us",           // Value for API
  interests: ["tech", "health"], // Values for API
  contact_preference: "email",   // Value for API
  name: "John Doe",         // Text input value
  email: "john@example.com", // Email input value
}
```

### Callbacks

#### onFormDataChange
Called whenever form data changes (debounced for performance).

```tsx
onFormDataChange={(formData) => {
  console.log("Form data updated:", formData);
  // Use for real-time validation or API updates
}}
```

#### onComplete
Called when the form is completed.

```tsx
onComplete={(formData) => {
  console.log("Form completed:", formData);
  // Send to API with the collected values
  submitToAPI(formData);
}}
```

## Performance Features

### Debounced Updates
Form data changes are debounced to prevent excessive API calls.

```tsx
<SentForm
  debounceDelay={500} // 500ms debounce (default: 300ms)
  onFormDataChange={handleDataChange}
  steps={steps}
/>
```

### Memoized Components
All step components are memoized to prevent unnecessary re-renders.

### Optimized State Management
Centralized form state with efficient updates.

## Best Practices

### 1. Always Start with Intro
```tsx
steps={[
  {
    type: "intro",
    id: "welcome",
  },
  // ... other steps
]}
```

### 2. Use Reusable Options
```tsx
const commonOptions = {
  countries: [
    { value: "us", label: "United States" },
    { value: "ca", label: "Canada" },
  ],
};

// Reuse across multiple forms
{
  type: "select",
  id: "location",
  options: commonOptions.countries,
}
```

### 3. Provide Helpful Text
```tsx
{
  type: "select",
  id: "location",
  title: "Where are you located?",
  placeholder: "Choose your country",
  helperText: "This helps us provide location-specific services",
}
```

### 4. Use Descriptive IDs
```tsx
// ✅ Good
id: "contact_preference"
id: "location"
id: "interests"

// ❌ Bad
id: "step1"
id: "field1"
```

### 5. Handle Form Data Properly
```tsx
onComplete={(formData) => {
  // formData contains values for API
  // Users see labels, API gets values
  submitToAPI(formData);
}}
```

## Examples

### Complete Form Example

<Canvas>
  <Story id="organisms-sentform--default" />
</Canvas>

### Simple Form Example

```tsx
<SentForm
  steps={[
    {
      type: "intro",
      id: "welcome",
    },
    {
      type: "description",
      id: "description",
      description: "Let's get to know you better.",
    },
    {
      type: "select",
      id: "location",
      title: "Where are you located?",
      options: commonOptions.countries,
    },
    {
      type: "choice",
      id: "contact_preference",
      label: "How should we contact you?",
      options: commonOptions.contactMethods,
    },
  ]}
  onComplete={(data) => {
    console.log("Simple form completed:", data);
  }}
/>
```

## Migration from Manual Composition

### Before (Manual Composition)
```tsx
// ❌ Verbose, requires manual imports
import { SelectField } from "./Steps/SelectField";
import { MultipleChoice } from "./Steps/MultipleChoice";

<SentForm
  steps={[
    {
      id: "location",
      content: (
        <SelectField
          title="Where are you located?"
          options={options}
        />
      ),
    },
  ]}
/>
```

### After (Configuration-Driven)
```tsx
// ✅ Clean, no imports needed
<SentForm
  steps={[
    {
      type: "select",
      id: "location",
      title: "Where are you located?",
      options: options,
    },
  ]}
/>
```

## Troubleshooting

### Common Issues

#### 1. Labels Not Displaying
Ensure your options have both `value` and `label` properties:
```tsx
// ✅ Correct
options={[
  { value: "us", label: "United States" },
  { value: "ca", label: "Canada" },
]}

// ❌ Incorrect
options={[
  { value: "us", name: "United States" },
  { value: "ca", name: "Canada" },
]}
```

#### 2. Form Data Not Updating
Check that your step IDs are unique:
```tsx
// ✅ Correct
{ type: "select", id: "location", ... }
{ type: "select", id: "country", ... }

// ❌ Incorrect (duplicate IDs)
{ type: "select", id: "location", ... }
{ type: "select", id: "location", ... }
```

#### 3. Performance Issues
Use debouncing for large forms:
```tsx
<SentForm
  debounceDelay={500}
  onFormDataChange={handleDataChange}
/>
```

## API Reference

### StepConfig Types

```tsx
type StepConfig = 
  | IntroStepConfig
  | DescriptionStepConfig
  | SelectStepConfig
  | MultiSelectStepConfig
  | ChoiceStepConfig
  | TextStepConfig
  | EmailStepConfig
  | PhoneStepConfig
  | NumberStepConfig
  | LongTextStepConfig
  | CheckboxStepConfig;
```

### FormData Type

```tsx
interface FormData {
  [stepId: string]: any;
}
```

### SentFormProps

```tsx
interface SentFormProps {
  steps: StepConfig[];
  onComplete?: (data: FormData) => void;
  onFormDataChange?: (formData: FormData) => void;
  debounceDelay?: number;
}
```

The `SentForm` component provides a complete, professional form experience with excellent developer experience and user experience. 